"use strict";tinymce.PluginManager.add("references",function(e,t){function n(e){return{name:"ETSI "+e[1]+" "+e[2]+(e[3]?" (V"+e[3]+")":""),org:"ETSI",type:e[1],reference:e[2],version:e[3],title:e[4]?e[4].replace(/^[:\s]+/u,"").trim():void 0}}function r(e){return{org:"ETSI",type:"IEEE",name:"IEEE "+e[1],reference:e[1],version:e[3],title:e[4]?e[4].replace(/^[:\s]+/u,"").trim():void 0}}function i(e){return void 0!==e.title&&0!=e.title.length||(e.title="To be requested..."),e.url=e.name.replace(/\s+/g,"_")+".pdf",e}function o(e){return void 0!==e.title&&0!=e.title.length||(e.title="To be requested..."),e.url=e.name.replace(/\s+/g,"_")+".pdf",e}function a(e,t){var n=e.dom,r=e.dom.doc,i=null;if("CITE"===t.parentNode.tagName)return null;var o=t.data.split(c);if(1===o.length)return null;var i=r.createDocumentFragment();for(i.appendChild(r.createTextNode(o.shift()));o.length;){for(var a=0;a<u.length;a++){var s=o.shift();if(void 0!==s){var d=s.match(u[a].rx);if(d&&d.length>1){d=u[a].handler(d);var f=l[d.reference];void 0===f&&(f=u[a].complete(d),l[f.reference]=f),n.add(i,"a",{class:"reference",href:f.url},'<cite title="'+f.title+'" name="'+f.name.replace(/\s+/,"_")+'">'+f.name+"</cite>")}}}i.appendChild(r.createTextNode(o.shift()))}return i}var s,l={},c=null,u=[{rx:/(?:ETSI\s+)?(SR|TR|TS|EG|ES|EN)\s+(\d\d\d\s+\d\d\d(?:-\d+)?(?:-\d+)?)\s*(?:[(-]+?[vV]?(\d+\.\d+\.\d+)\)?)?/u,rxDetect:"(?:ETSI\\s+)?(?:SR|TR|TS|EG|ES|EN)\\s+\\d\\d\\d\\s+\\d\\d\\d(?:-\\d+)?(?:-\\d+)?\\s*(?:-?\\(?(?:[vV]\\.?)?\\d+\\.\\d+\\.\\d+\\)?)?",handler:n,complete:i},{rx:/(?:ETSI\s+)?(GR|GS)\s+([A-Z0-9]+(?:-[A-Z0-9]+)?\s+\d+(?:-\d+)?(?:-\d+)?)\s*(?:[(-vV]*(\d+\.\d+\.\d+)\)?)?/u,rxDetect:"(?:ETSI\\s+)?(?:GR|GS)\\s+[A-Z0-9]+(?:-[A-Z0-9]+)?\\s+\\d+(?:-\\d+)?(?:-\\d+)?\\s*(?:-?\\(?(?:[vV]\\.?)?\\d+\\.\\d+\\.\\d+\\)?)?",handler:n,complete:i},{rx:/IEEE(?:\s+Std\.?)?\s+((\d+(?:\.\w+))(?:-(\w+))?)/u,rxDetect:"IEEE(?:\\s+Std\\.?)?[\\s-]*\\d+(?:\\.\\w+)(?:-\\w+)?",handler:r,complete:o}],d={name:"references",processTextNode:a};return tinymce.DOM.styleSheetLoader.load(t+"/css/refpanel.css"),e.on("init",function(){e.settings.refpanel_show_on_start&&e.execCommand("mceShowRefPanel")}),e.fire("mceInlineRegister",d),e.on("mceInlineSetContent",function(){var t=e.dom;e.dom.doc;l={};var n=t.select("#references"),n=t.select('section:has(h1:contains("References"))');if(n.length)for(var r=0;r<n.length;r++)for(var i=t.select("p,li",n[r]),o=0;o<i.length;o++){var a=i[o].textContent;if(a=a.split(/^(?:\[((i\.)?\d+)\])\s*(.*)/gmu),a.length>1)for(var s=0;s<u.length;s++){var d=a[3].split(u[s].rx);if(d.length>1){var f=u[s].handler(d);f.id=a[1],f.informative=void 0!=a[2],f=u[s].complete(f),l[f.reference]=f;break}}}c="("+u[0].rxDetect+")";for(var s=1,o=u.length;s<o;s++)c+="|("+u[s].rxDetect+")";c=new RegExp(c,"gmu")}),e.addCommand("mceShowRefPanel",function(){function t(){var e=n.$("cite",r),t=0;tinymce.each(e,function(e){t<e.offsetWidth&&(t=e.offsetWidth)}),e.css("width",t+"px")}var n=e.dom;if(s)e.fire("DeleteSidePanel",{item:s}),s=null;else{s=tinymce.ui.Factory.create({type:"control",name:"ref-panel",classes:"ref-panel",title:"References"}),e.fire("AddSidePanel",{item:s,side:"left"});var r=n.doc.createElement("ul");tinymce.each(l,function(t){function i(e){n.$("style#ref-highlight").remove(),e&&e.length&&n.$("head").append('<style id="ref-highlight">cite[name="'+e+'"]{background-color:yellow;}</style>')}var o=e.dom.doc.createElement("li");n.add(o,"cite",{title:t.title},t.name);t.informative&&n.add(o,"span",{class:"informative"},"[Informative]"),o.addEventListener("click",function(t){i(n.$("cite",this)[0].textContent.trim().replace(/\s+/,"_")),n.$("li.current",this.parentNode).removeClass("current"),this.classList.add("current"),e.focus()}),r.appendChild(o)}),s.getEl().appendChild(r)}e.focus(),e.fire("RefPanelStateChanged",{state:!!s}),t()}),e.addMenuItem("refPanel",{text:"References",selectable:!0,cmd:"mceShowRefPanel",onPostRender:function(){var t=this;t.active(!!s),e.on("RefPanelStateChanged",function(e){t.active(e.state)})},context:"view"}),{}},["inlines","sidepanel"]);