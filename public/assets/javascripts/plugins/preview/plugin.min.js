tinymce.PluginManager.add("preview",function(e){function t(){var e,t,n=window,r=document,i=r.body;return i.offsetWidth&&(e=i.offsetWidth,t=i.offsetHeight),n.innerWidth&&n.innerHeight&&(e=n.innerWidth,t=n.innerHeight),{w:e,h:t}}var n=e.settings,r=!tinymce.Env.ie;e.addCommand("mcePreview",function(){var i=t();i.w=4*i.w/5,i.h=4*i.h/5,e.windowManager.open({title:"Preview",width:parseInt(e.getParam("plugin_preview_width",i.w),10),height:parseInt(e.getParam("plugin_preview_height",i.h),10),html:'<iframe src="javascript:\'\'" frameborder="0"'+(r?' sandbox="allow-scripts"':"")+"></iframe>",buttons:{text:"Close",onclick:function(){this.parent().parent().close()}},onPostRender:function(){var t,i="";i+='<base href="'+e.documentBaseURI.getURI()+'">';var o={headHtml:i};e.fire("PrepareHeadHtml",o),i=o.headHtml,tinymce.each(e.contentCSS,function(t){i+='<link type="text/css" rel="stylesheet" href="'+e.documentBaseURI.toAbsolute(t)+'">'});var a=n.body_id||"tinymce";a.indexOf("=")!=-1&&(a=e.getParam("body_id","","hash"),a=a[e.id]||a);var s=n.body_class||"";s.indexOf("=")!=-1&&(s=e.getParam("body_class","","hash"),s=s[e.id]||"");var l='<script>document.addEventListener && document.addEventListener("click", function(e) {for (var elm = e.target; elm; elm = elm.parentNode) {if (elm.nodeName === "A") {e.preventDefault();}}}, false);</script> ',c=e.settings.directionality?' dir="'+e.settings.directionality+'"':"";if(t="<!DOCTYPE html><html><head>"+i+'</head><body id="'+a+'" class="mce-content-body '+s+'"'+c+">"+e.getContent()+l+"</body></html>",r)this.getEl("body").firstChild.src="data:text/html;charset=utf-8,"+encodeURIComponent(t);else{var u=this.getEl("body").firstChild.contentWindow.document;u.open(),u.write(t),u.close()}}})}),e.addButton("preview",{title:"Preview",cmd:"mcePreview"}),e.addMenuItem("preview",{text:"Preview",cmd:"mcePreview",context:"view"})});